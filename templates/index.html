{% extends "base.html" %}

{% block content %}
{% set current_query = request.query_string.decode() %}
    <h1 class="mb-3">My Tasks</h1>
	
	<form method="POST" action="{{ url_for('add_task') }}" class="mb-4">
		<div class="row g-2">
			<div class="col-md-6">
				<input type="text"
					name="title"
					class="form-control"
					placeholder="New task..."
					required>
			</div>
	
			<div class="col-md-4">
				<input type="date"
					name="due_date"
					class="form-control">
			</div>
	
			<div class="col-md-2">
				<button class="btn btn-primary w-100">Add</button>
			</div>
		</div>
	</form>

	<form method="GET" class="row g-2 mb-4">

		<div class="col-md-4">
			<select name="status" class="form-select">
				<option value="">All</option>
				<option value="pending"
					{% if request.args.get('status') == 'pending' %}selected{% endif %}>
					Incomplete
				</option>
				<option value="completed"
					{% if request.args.get('status') == 'completed' %}selected{% endif %}>
					Completed
				</option>
			</select>
		</div>
	
		<div class="col-md-4">
			<input type="date"
				name="date"
				class="form-control"
				value="{{ request.args.get('date') or '' }}">
		</div>
	
		<div class="col-md-4">
			<button class="btn btn-outline-primary w-100">
				Apply filters
			</button>
		</div>
	
	</form>






	<ul class="list-group">
		{% for task in tasks %}
			<li class="list-group-item d-flex justify-content-between align-items-center">
	
			<div>
				<strong
					{% if task["completed"] %}
						style="text-decoration: line-through;"
					{% elif task["due_date"] and task["due_date"] < today %}
						class="text-danger"
					{% endif %}
				>
					{{ task["title"] }}
				</strong>
			
				{% if task["due_date"] %}
					<small class="d-block
						{% if not task["completed"] and task["due_date"] < today %}
							text-danger
						{% else %}
							text-muted
						{% endif %}
					">
						Due: {{ task["due_date"] }}
					</small>
				{% endif %}
			</div>

			
	
			<div>
					<a href="{{ url_for('toggle_task', id=task['id']) }}{% if current_query %}?{{ current_query }}{% endif %}"
					   class="btn btn-sm {% if task['completed'] %}btn-secondary{% else %}btn-success{% endif %}">
						{% if task['completed'] %}
							Undo
						{% else %}
							Complete
						{% endif %}
					</a>
			
					<a href="{{ url_for('edit_task', id=task['id']) }}{% if current_query %}?{{ current_query }}{% endif %}"
					class="btn btn-sm btn-warning">
						Edit
					</a>
			
				<a href="{{ url_for('delete_task', id=task['id']) }}{% if current_query %}?{{ current_query }}{% endif %}"
				class="btn btn-sm btn-danger"
				onclick="return confirm('Are you sure you want to delete this task?');">
					Delete
				</a>
			</div>

	
			</li>
		{% else %}
			<li class="list-group-item text-muted">No tasks yet</li>
		{% endfor %}
	</ul>




{% endblock %}
